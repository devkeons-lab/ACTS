# 코인 자동 매매 시스템 요구사항

## 소개

코인 자동 매매 시스템은 GPT 기반 AI 판단을 통해 Bybit 거래소에서 자동 매매를 수행하는 시스템입니다. 시스템은 다음과 같이 구성됩니다:

1. **데이터 수집 서버**: Bybit에서 실시간 캔들 데이터를 수집하여 Redis에 저장
2. **자동매매 서버**: GPT 분석을 통해 5분마다 자동 매매 실행
3. **프론트엔드**: Next.js 기반 웹 애플리케이션으로 차트 조회 및 설정 관리
4. **MySQL**: 사용자 정보 및 API 키 저장

## 요구사항

### 요구사항 1: 사용자 인증 및 관리

**사용자 스토리:** 사용자로서, 이메일과 비밀번호로 안전하게 로그인하고 세션을 유지할 수 있어야 하므로, 개인 설정과 API 키가 보호받을 수 있다.

#### 승인 기준

1. WHEN 사용자가 이메일과 비밀번호로 회원가입하면 THEN 시스템은 MySQL에 사용자 정보를 저장해야 한다
2. WHEN 사용자가 로그인하면 THEN 시스템은 JWT 토큰을 httpOnly 쿠키로 발급해야 한다
3. WHEN 사용자가 인증이 필요한 페이지에 접근하면 THEN 시스템은 JWT 토큰을 검증해야 한다
4. WHEN 사용자가 로그아웃하면 THEN 시스템은 쿠키를 삭제해야 한다

### 요구사항 2: Bybit API 키 관리

**사용자 스토리:** 사용자로서, Bybit API 키와 시크릿 키를 등록하고 검증할 수 있어야 하므로, 자동 매매가 내 계정에서 실행될 수 있다.

#### 승인 기준

1. WHEN 사용자가 API 키와 시크릿 키를 입력하면 THEN 시스템은 Bybit API를 통해 유효성을 검증해야 한다
2. WHEN API 키가 유효하면 THEN 시스템은 AES256 암호화하여 MySQL에 저장해야 한다
3. WHEN 저장된 API 키가 있으면 THEN 프론트엔드에서 마스킹 처리하여 표시해야 한다
4. WHEN API 키 검증이 실패하면 THEN 시스템은 구체적인 오류 메시지를 제공해야 한다

### 요구사항 3: 자동매매 설정 관리

**사용자 스토리:** 사용자로서, 위험도, 레버리지, GPT 프롬프트 등을 설정할 수 있어야 하므로, 내 투자 성향에 맞는 자동 매매가 가능하다.

#### 승인 기준

1. WHEN 사용자가 위험도를 설정하면 THEN 시스템은 low/medium/high 중 하나를 선택하여 저장해야 한다
2. WHEN 사용자가 최대 레버리지를 설정하면 THEN 시스템은 해당 값을 MySQL에 저장해야 한다
3. WHEN 사용자가 GPT 프롬프트를 커스터마이징하면 THEN 시스템은 수정된 프롬프트를 저장해야 한다
4. WHEN 사용자가 자동매매를 활성화/비활성화하면 THEN 시스템은 auto_trade_enabled 플래그를 업데이트해야 한다

### 요구사항 4: 실시간 캔들 데이터 수집 및 저장

**사용자 스토리:** 사용자로서, 실시간 BTCUSDT 1분봉 차트를 확인할 수 있어야 하므로, 현재 시장 상황을 파악할 수 있다.

#### 승인 기준

1. WHEN 데이터 서버가 시작되면 THEN Bybit REST API로 BTCUSDT 1분봉 5000개를 Redis에 저장해야 한다
2. WHEN Bybit WebSocket에서 새로운 캔들이 수신되면 THEN Redis에 LPUSH로 추가하고 LTRIM으로 5000개를 유지해야 한다
3. WHEN 프론트엔드에서 차트 데이터를 요청하면 THEN Redis에서 최신 30개 캔들을 반환해야 한다
4. WHEN WebSocket 연결이 끊어지면 THEN 시스템은 자동으로 재연결을 시도해야 한다

### 요구사항 5: GPT 기반 자동매매 실행

**사용자 스토리:** 사용자로서, GPT가 차트를 분석하여 자동으로 매매를 실행할 수 있어야 하므로, 24시간 지속적인 거래가 가능하다.

#### 승인 기준

1. WHEN 자동매매 서버가 5분마다 실행되면 THEN Redis에서 최신 30개 캔들을 가져와야 한다
2. WHEN 캔들 데이터를 GPT에 전송하면 THEN 매수/매도/보류 판단과 레버리지 제안을 받아야 한다
3. WHEN GPT가 매매 신호를 제공하면 THEN auto_trade_enabled=true인 사용자들의 Bybit API로 주문을 실행해야 한다
4. WHEN 주문이 실행되면 THEN 성공/실패 결과를 로그로 저장해야 한다

### 요구사항 6: 프론트엔드 차트 및 제어 패널

**사용자 스토리:** 사용자로서, 실시간 차트를 보고 자동매매를 제어할 수 있어야 하므로, 시장 상황을 모니터링하고 설정을 조정할 수 있다.

#### 승인 기준

1. WHEN 대시보드에 접근하면 THEN lightweight-charts로 실시간 BTCUSDT 차트를 표시해야 한다
2. WHEN 자동매매 토글을 클릭하면 THEN 자동매매 활성화/비활성화 상태를 변경해야 한다
3. WHEN 위험도 슬라이더를 조정하면 THEN 서버에 새로운 위험도 설정을 전송해야 한다
4. WHEN 설정 페이지에서 GPT 프롬프트를 수정하면 THEN 커스텀 프롬프트를 저장해야 한다

### 요구사항 7: 자동매매 결과 조회 (선택사항)

**사용자 스토리:** 사용자로서, GPT 판단 결과와 실행된 주문 내역을 확인할 수 있어야 하므로, 자동매매 성과를 분석할 수 있다.

#### 승인 기준

1. WHEN 사용자가 로그 페이지에 접근하면 THEN GPT 판단 결과와 주문 실행 내역을 표시해야 한다
2. WHEN 자동매매가 실행되면 THEN 판단 근거, 실행 시간, 주문 결과를 기록해야 한다
3. WHEN 사용자가 날짜별로 필터링하면 THEN 해당 기간의 거래 내역만 표시해야 한다
4. WHEN 거래 내역을 클릭하면 THEN 상세한 GPT 분석 내용을 표시해야 한다

### 요구사항 8: 시스템 보안 및 안정성

**사용자 스토리:** 사용자로서, API 키와 개인정보가 안전하게 보호되는 시스템을 사용할 수 있어야 하므로, 안심하고 자동 거래를 맡길 수 있다.

#### 승인 기준

1. WHEN Bybit API 키가 저장되면 THEN AES256 암호화하여 MySQL에 보관해야 한다
2. WHEN 모든 API 통신이 발생하면 THEN HTTPS를 통해 안전하게 전송되어야 한다
3. WHEN Redis 접근이 필요하면 THEN 외부 접근을 차단하고 내부 서버만 접근 가능해야 한다
4. WHEN GPT 응답을 받으면 THEN 허용된 조건 내에서만 매매를 실행하도록 검증해야 한다